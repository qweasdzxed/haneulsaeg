<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 변경사항 모니터링</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse { animation: pulse 2s infinite; }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .slide-in { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- 헤더 -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                GitHub 변경사항 모니터링
            </h1>
            <p class="text-gray-600">저장소의 변경사항을 실시간으로 추적합니다</p>
        </div>

        <!-- 통계 카드 -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-indigo-500">
                <h3 class="text-sm font-medium text-gray-600 mb-2">총 커밋</h3>
                <div class="flex items-baseline gap-1">
                    <span id="totalCommits" class="text-3xl font-bold text-gray-800">0</span>
                    <span class="text-sm text-gray-500">개</span>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                <h3 class="text-sm font-medium text-gray-600 mb-2">추가된 줄</h3>
                <div class="flex items-baseline gap-1">
                    <span id="totalAdditions" class="text-3xl font-bold text-green-600">0</span>
                    <span class="text-sm text-gray-500">줄</span>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
                <h3 class="text-sm font-medium text-gray-600 mb-2">삭제된 줄</h3>
                <div class="flex items-baseline gap-1">
                    <span id="totalDeletions" class="text-3xl font-bold text-red-600">0</span>
                    <span class="text-sm text-gray-500">줄</span>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                <h3 class="text-sm font-medium text-gray-600 mb-2">변경된 파일</h3>
                <div class="flex items-baseline gap-1">
                    <span id="totalFiles" class="text-3xl font-bold text-purple-600">0</span>
                    <span class="text-sm text-gray-500">개</span>
                </div>
            </div>
        </div>

        <!-- 최근 커밋 상세 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">최근 커밋 내역</h2>
                <span id="lastUpdate" class="text-sm text-gray-500">마지막 업데이트: --:--</span>
            </div>
            <div id="commitList" class="space-y-4">
                <p class="text-gray-500 text-center py-8 pulse">데이터를 불러오는 중...</p>
            </div>
        </div>

        <!-- 파일 변경 통계 -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">가장 많이 변경된 파일 TOP 10</h2>
            <div id="fileStats" class="space-y-3">
                <p class="text-gray-500 text-center py-8">데이터를 분석하는 중...</p>
            </div>
        </div>

        <!-- 푸터 -->
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>자동 업데이트: 1분마다 · Repository: qweasdzxed/haneulsaeg</p>
        </div>
    </div>

    <script>
        let fileChangeCount = {};

        // GitHub 커밋 상세 정보 가져오기
        async function updateGitHubStats() {
            try {
                const response = await fetch('https://api.github.com/repos/qweasdzxed/haneulsaeg/commits?per_page=10');
                const commits = await response.json();
                
                if (!Array.isArray(commits)) {
                    throw new Error('Invalid response');
                }

                document.getElementById('totalCommits').textContent = commits.length;
                document.getElementById('lastUpdate').textContent = `마지막 업데이트: ${new Date().toLocaleTimeString('ko-KR')}`;
                
                let totalAdditions = 0;
                let totalDeletions = 0;
                let totalFiles = 0;
                
                // 각 커밋의 상세 정보 가져오기
                const detailedCommits = await Promise.all(
                    commits.map(async (commit) => {
                        try {
                            const detailResponse = await fetch(commit.url);
                            const detail = await detailResponse.json();
                            
                            totalAdditions += detail.stats?.additions || 0;
                            totalDeletions += detail.stats?.deletions || 0;
                            totalFiles += detail.files?.length || 0;
                            
                            // 파일별 변경 횟수 추적
                            if (detail.files) {
                                detail.files.forEach(file => {
                                    fileChangeCount[file.filename] = (fileChangeCount[file.filename] || 0) + 1;
                                });
                            }
                            
                            return {
                                message: commit.commit.message,
                                author: commit.commit.author.name,
                                date: new Date(commit.commit.author.date).toLocaleString('ko-KR'),
                                sha: commit.sha.substring(0, 7),
                                stats: detail.stats,
                                files: detail.files || []
                            };
                        } catch (error) {
                            console.error('커밋 상세 정보 오류:', error);
                            return null;
                        }
                    })
                );

                document.getElementById('totalAdditions').textContent = totalAdditions;
                document.getElementById('totalDeletions').textContent = totalDeletions;
                document.getElementById('totalFiles').textContent = totalFiles;
                
                // 커밋 목록 렌더링
                const commitList = document.getElementById('commitList');
                commitList.innerHTML = detailedCommits
                    .filter(c => c !== null)
                    .map(commit => `
                        <div class="border-l-4 border-indigo-500 pl-4 py-3 hover:bg-gray-50 transition slide-in">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1">
                                    <p class="font-semibold text-gray-800 text-lg">${commit.message}</p>
                                    <p class="text-sm text-gray-500 mt-1">
                                        <span class="font-medium">${commit.author}</span> · 
                                        ${commit.date} · 
                                        <code class="bg-gray-100 px-2 py-0.5 rounded text-xs">${commit.sha}</code>
                                    </p>
                                </div>
                                <div class="text-right ml-4">
                                    <div class="text-xs text-gray-600">
                                        <span class="text-green-600 font-medium">+${commit.stats?.additions || 0}</span> / 
                                        <span class="text-red-600 font-medium">-${commit.stats?.deletions || 0}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${commit.files.length > 0 ? `
                                <div class="mt-3 space-y-1">
                                    <p class="text-xs text-gray-600 font-medium mb-1">변경된 파일 (${commit.files.length}개):</p>
                                    ${commit.files.slice(0, 5).map(file => `
                                        <div class="flex items-center gap-2 text-sm bg-gray-50 px-3 py-1.5 rounded">
                                            <span class="flex-1 font-mono text-xs text-gray-700">${file.filename}</span>
                                            <span class="text-xs">
                                                <span class="text-green-600">+${file.additions}</span> / 
                                                <span class="text-red-600">-${file.deletions}</span>
                                            </span>
                                            <span class="text-xs px-2 py-0.5 rounded ${
                                                file.status === 'added' ? 'bg-green-100 text-green-700' :
                                                file.status === 'removed' ? 'bg-red-100 text-red-700' :
                                                'bg-blue-100 text-blue-700'
                                            }">${
                                                file.status === 'added' ? '추가' :
                                                file.status === 'removed' ? '삭제' :
                                                file.status === 'renamed' ? '이름변경' : '수정'
                                            }</span>
                                        </div>
                                    `).join('')}
                                    ${commit.files.length > 5 ? `<p class="text-xs text-gray-500 pl-3">... 외 ${commit.files.length - 5}개</p>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                
                // 파일 변경 통계 업데이트
                updateFileStats();
                
            } catch (error) {
                console.error('GitHub API 오류:', error);
                document.getElementById('commitList').innerHTML = '<p class="text-red-500 text-center py-4">데이터를 불러올 수 없습니다. API 제한에 도달했을 수 있습니다.</p>';
            }
        }

        // 파일 변경 통계 업데이트
        function updateFileStats() {
            const sorted = Object.entries(fileChangeCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const maxCount = sorted[0]?.[1] || 1;
            
            const fileStats = document.getElementById('fileStats');
            if (sorted.length === 0) {
                fileStats.innerHTML = '<p class="text-gray-500 text-center py-4">파일 변경 통계가 없습니다.</p>';
                return;
            }
            
            fileStats.innerHTML = sorted.map(([filename, count], index) => {
                const percentage = (count / maxCount) * 100;
                return `
                    <div class="slide-in">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-sm font-bold text-gray-500 w-6">${index + 1}</span>
                            <span class="flex-1 font-mono text-sm text-gray-700">${filename}</span>
                            <span class="text-sm font-semibold text-indigo-600">${count}회</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 ml-9">
                            <div class="h-full bg-indigo-500 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 초기 실행
        updateGitHubStats();
        
        // 1분마다 자동 업데이트
        setInterval(updateGitHubStats, 60000);
    </script>
</body>
</html>